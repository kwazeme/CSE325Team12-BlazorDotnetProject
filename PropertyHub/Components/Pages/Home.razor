@page "/"
@inject ApplicationDbContext DbContext
@inject AuthenticationStateProvider AuthenticationStateProvider
@inject UserManager<ApplicationUser> UserManager

<PageTitle>Home | PropertyHub</PageTitle>

<AuthorizeView>

    <Authorized>
        <!-- Dashboard Header -->
        <div class="dashboard-header mb-4">
            <h1>Dashboard</h1>
            <p class="text-muted">Welcome back! Here's your property management overview.</p>
        </div>

        <!-- Stats Cards -->
        <div class="row g-3 mb-4">
            <div class="col-md-3">
                <div class="card shadow-sm h-100">
                    <div class="card-title">
                        Active Listings
                    </div>
                    <div class="card-body">
                        <div class="card-text">
                            <p class="stat-value">@activeListings</p>
                            <span class="stat-label">Properties</span>
                        </div>
                        <NavLink class="btn btn-outline-primary w-100 mt-2" href="listings">
                            <i class="bi bi-house-door me-2"></i>
                            View Listings
                        </NavLink>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card shadow-sm h-100">
                    <div class="card-title">
                        Tenants
                    </div>
                    <div class="card-body">
                        <div class="card-text">
                            <p class="stat-value">@totalTenants</p>
                            <span class="stat-label">Total</span>
                        </div>
                        <NavLink class="btn btn-outline-primary w-100 mt-2" href="tenants">
                            <i class="bi bi-people"></i>
                            Manage Tenants
                        </NavLink>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card shadow-sm h-100">
                    <div class="card-title">
                        Active Leases
                    </div>
                    <div class="card-body">
                        <div class="card-text">
                            <p class="stat-value">@activeLeases</p>
                            <span class="stat-label">Agreements</span>
                        </div>
                        <NavLink class="btn btn-outline-primary w-100 mt-2" href="leases">
                            <i class="bi bi-key me-2"></i>
                            View Leases
                        </NavLink>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card shadow-sm h-100">
                    <div class="card-title">
                        Maintenance
                    </div>
                    <div class="card-body">
                        <div class="card-text">
                            <p class="stat-value">@pendingMaintenance</p>
                            <span class="stat-label">Pending</span>
                        </div>
                        <NavLink class="btn btn-outline-primary w-100 mt-2" href="maintenance">
                            <i class="bi bi-tools me-2"></i>
                            Maintenance
                        </NavLink>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tips -->
        <div class="card shadow-sm h-100 tips-card">
            <div class="card-header bg-light">
                <h5 class="mb-0">💡 Pro Tips</h5>
            </div>
            <div class="card-body">
                <div class="row g-3 mb-4">
                    <div class="col-lg-6">
                        <div class="tip-item">
                            <strong>Keep Leases Updated</strong>
                            <p>Always update lease information to avoid confusion and disputes with tenants.</p>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="tip-item">
                            <strong>Document Everything</strong>
                            <p>Maintain clear records of all tenant communications and property issues.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </Authorized>

    <NotAuthorized>
        <!-- Hero Section -->
        <div class="hero-section">
            <div class="hero-overlay"></div>
            <div class="hero-content">
                <h1 class="hero-title">PropertyHub</h1>
                <p class="hero-subtitle">Your Complete Rental Property Management Solution</p>
                <p class="hero-description">Streamline property management, track leases, manage tenants, and handle maintenance requests all in one platform.</p>
                <div class="hero-buttons mt-4">
                    <NavLink class="btn btn-primary btn-lg me-3" href="Account/Register">
                        Get Started Free
                    </NavLink>
                    <NavLink class="btn btn-outline-light btn-lg" href="Account/Login">
                        Sign In
                    </NavLink>
                </div>
            </div>
        </div>

        <!-- Features Section -->
        <div class="features-section py-5">
            <div class="container">
                <h2 class="text-center mb-5">Why Choose PropertyHub?</h2>
                <div class="row g-4">
                    <div class="col-md-6 col-lg-3">
                        <div class="feature-card">
                            <div class="feature-icon">
                                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                                    <polyline points="9 22 9 12 15 12 15 22"></polyline>
                                </svg>
                            </div>
                            <h5>Property Management</h5>
                            <p>Easily manage all your rental properties in one centralized location.</p>
                        </div>
                    </div>

                    <div class="col-md-6 col-lg-3">
                        <div class="feature-card">
                            <div class="feature-icon">
                                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                    <circle cx="9" cy="7" r="4"></circle>
                                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                                </svg>
                            </div>
                            <h5>Tenant Tracking</h5>
                            <p>Keep comprehensive records of all your tenants and their information.</p>
                        </div>
                    </div>

                    <div class="col-md-6 col-lg-3">
                        <div class="feature-card">
                            <div class="feature-icon">
                                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                    <polyline points="14 2 14 8 20 8"></polyline>
                                </svg>
                            </div>
                            <h5>Lease Management</h5>
                            <p>Track lease agreements and stay updated on expiration dates.</p>
                        </div>
                    </div>

                    <div class="col-md-6 col-lg-3">
                        <div class="feature-card">
                            <div class="feature-icon">
                                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 5v14M5 12h14"></path>
                                </svg>
                            </div>
                            <h5>Maintenance Requests</h5>
                            <p>Handle maintenance requests efficiently and keep properties in great condition.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- CTA Section -->
        <div class="cta-section py-5 text-center">
            <h2 class="mb-4">Ready to Simplify Your Property Management?</h2>
            <p class="lead mb-4">Join hundreds of property managers using PropertyHub to streamline their operations.</p>
            <NavLink class="btn btn-primary btn-lg" href="Account/Register">
                Start Your Free Account Today
            </NavLink>
        </div>
    </NotAuthorized>

</AuthorizeView>

@code {
    private int activeListings = 0;
    private int totalTenants = 0;
    private int activeLeases = 0;
    private int pendingMaintenance = 0;


    protected override async Task OnInitializedAsync()
    {
        
        var userId = await GetUserIdAsync();
        if (!string.IsNullOrEmpty(userId))
        {
            // Get active listings for current user
            activeListings = DbContext.Listings
                .Count(l => l.OwnerId == userId);

            // Get total tenants for current user
            totalTenants = DbContext.Tenants
                .Count(t => t.OwnerId == userId);

            // Get active leases (leases that haven't ended yet) for current user
            activeLeases = DbContext.Leases
                .Count(l => l.OwnerId == userId && l.EndDate > DateTime.Now);

            // Get pending maintenance requests for current user's listings
            pendingMaintenance = DbContext.MaintenanceRequests
                .Where(m => !m.IsCompleted && 
                           DbContext.Listings.Any(l => l.Id == m.ListingId && l.OwnerId == userId))
                .Count();
        }
    }

    private async Task<string?> GetUserIdAsync()
    {
        var authState = await AuthenticationStateProvider.GetAuthenticationStateAsync();
        return UserManager.GetUserId(authState.User);
    }
}
